<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento - Loja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Sistema da Loja</h1>
                <p class="text-gray-600">Acesso Administrativo</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usuário</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Digite seu usuário" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Digite sua senha" required>
                </div>
                
                <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition duration-200 font-medium">
                    Entrar no Sistema
                </button>
            </form>
            
            <div id="loginError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden">
                Usuário ou senha incorretos!
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-800"><strong>Demo:</strong></p>
                <p class="text-xs text-blue-600">Usuário: admin | Senha: 123456</p>
            </div>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-indigo-600 w-10 h-10 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">Sistema de Gerenciamento</h1>
                            <p class="text-sm text-gray-600">Controle de Clientes e Vendas</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Bem-vindo, Administrador</span>
                        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Estatísticas -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total de Clientes</p>
                            <p id="totalClients" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total em Aberto</p>
                            <p id="totalDebt" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Vendas Hoje</p>
                            <p id="todaySales" class="text-2xl font-bold text-purple-600">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área de Cadastro e Busca -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Cadastro de Cliente -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                        Cadastrar Cliente
                    </h2>
                    
                    <form id="clientForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                            <input type="text" id="clientName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Digite o nome do cliente" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                            <input type="tel" id="clientPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="(00) 00000-0000">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Endereço</label>
                            <input type="text" id="clientAddress" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Endereço do cliente">
                        </div>
                        
                        <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition duration-200 font-medium">
                            Cadastrar Cliente
                        </button>
                    </form>
                </div>

                <!-- Busca de Cliente -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        Buscar Cliente
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Cliente</label>
                            <input type="text" id="searchClient" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Digite o nome para buscar">
                        </div>
                        
                        <div id="searchResults" class="space-y-2 max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <!-- Lista de Clientes -->
            <div class="bg-white rounded-xl shadow-lg">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                        Lista de Clientes
                    </h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contato</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor em Aberto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Última Compra</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientsList" class="bg-white divide-y divide-gray-200">
                            <!-- Clientes serão inseridos aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Cliente -->
    <div id="clientModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Gerenciar Cliente</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <!-- Informações do Cliente -->
                <div id="clientInfo" class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <!-- Informações serão inseridas aqui -->
                </div>
                
                <!-- Adicionar Compra -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Adicionar Nova Compra</h4>
                    <form id="purchaseForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Produto/Descrição</label>
                            <input type="text" id="productName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Nome do produto" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor</label>
                            <input type="number" id="productValue" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="0,00" required>
                        </div>
                        
                        <div class="md:col-span-2">
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                Adicionar Compra
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Histórico de Compras -->
                <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Histórico de Compras</h4>
                    <div id="purchaseHistory" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Histórico será inserido aqui -->
                    </div>
                </div>
                
                <!-- Pagamento -->
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Registrar Pagamento</h4>
                    <form id="paymentForm" class="flex gap-4">
                        <input type="number" id="paymentAmount" step="0.01" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Valor do pagamento">
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                            Registrar Pagamento
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulação de banco de dados local
        class LocalDatabase {
            constructor() {
                this.clients = JSON.parse(localStorage.getItem('clients') || '[]');
                this.purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                this.payments = JSON.parse(localStorage.getItem('payments') || '[]');
            }
            
            saveClients() {
                localStorage.setItem('clients', JSON.stringify(this.clients));
            }
            
            savePurchases() {
                localStorage.setItem('purchases', JSON.stringify(this.purchases));
            }
            
            savePayments() {
                localStorage.setItem('payments', JSON.stringify(this.payments));
            }
            
            addClient(client) {
                client.id = Date.now().toString();
                client.createdAt = new Date().toISOString();
                this.clients.push(client);
                this.saveClients();
                return client;
            }
            
            addPurchase(purchase) {
                purchase.id = Date.now().toString();
                purchase.date = new Date().toISOString();
                this.purchases.push(purchase);
                this.savePurchases();
                return purchase;
            }
            
            addPayment(payment) {
                payment.id = Date.now().toString();
                payment.date = new Date().toISOString();
                this.payments.push(payment);
                this.savePayments();
                return payment;
            }
            
            getClientDebt(clientId) {
                const purchases = this.purchases.filter(p => p.clientId === clientId);
                const payments = this.payments.filter(p => p.clientId === clientId);
                
                const totalPurchases = purchases.reduce((sum, p) => sum + p.value, 0);
                const totalPayments = payments.reduce((sum, p) => sum + p.value, 0);
                
                return totalPurchases - totalPayments;
            }
            
            searchClients(query) {
                return this.clients.filter(client => 
                    client.name.toLowerCase().includes(query.toLowerCase())
                );
            }
        }

        const db = new LocalDatabase();
        let currentClient = null;

        // Sistema de Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === '123456') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainSystem').classList.remove('hidden');
                updateDashboard();
                loadClientsList();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainSystem').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.add('hidden');
        });

        // Cadastro de Cliente
        document.getElementById('clientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const client = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                address: document.getElementById('clientAddress').value
            };
            
            db.addClient(client);
            
            // Limpar formulário
            this.reset();
            
            // Atualizar dashboard e lista
            updateDashboard();
            loadClientsList();
            
            // Feedback visual
            showNotification('Cliente cadastrado com sucesso!', 'success');
        });

        // Busca de Cliente
        document.getElementById('searchClient').addEventListener('input', function(e) {
            const query = e.target.value;
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            const results = db.searchClients(query);
            
            resultsDiv.innerHTML = results.map(client => `
                <div class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer" onclick="openClientModal('${client.id}')">
                    <div class="font-medium text-gray-800">${client.name}</div>
                    <div class="text-sm text-gray-600">${client.phone || 'Sem telefone'}</div>
                    <div class="text-sm font-medium text-green-600">Deve: R$ ${db.getClientDebt(client.id).toFixed(2)}</div>
                </div>
            `).join('');
        });

        // Atualizar Dashboard
        function updateDashboard() {
            document.getElementById('totalClients').textContent = db.clients.length;
            
            const totalDebt = db.clients.reduce((sum, client) => sum + db.getClientDebt(client.id), 0);
            document.getElementById('totalDebt').textContent = `R$ ${totalDebt.toFixed(2)}`;
            
            const today = new Date().toDateString();
            const todaySales = db.purchases.filter(p => new Date(p.date).toDateString() === today).length;
            document.getElementById('todaySales').textContent = todaySales;
        }

        // Carregar Lista de Clientes
        function loadClientsList() {
            const tbody = document.getElementById('clientsList');
            
            tbody.innerHTML = db.clients.map(client => {
                const debt = db.getClientDebt(client.id);
                const lastPurchase = db.purchases
                    .filter(p => p.clientId === client.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                return `
                    <tr class="hover:bg-gray-50 slide-in">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${client.name}</div>
                            <div class="text-sm text-gray-500">${client.address || 'Sem endereço'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${client.phone || 'Sem telefone'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-sm font-medium ${debt > 0 ? 'text-red-600' : 'text-green-600'}">
                                R$ ${debt.toFixed(2)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${lastPurchase ? new Date(lastPurchase.date).toLocaleDateString('pt-BR') : 'Nenhuma compra'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="openClientModal('${client.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                Gerenciar
                            </button>
                            <button onclick="deleteClient('${client.id}')" class="text-red-600 hover:text-red-900">
                                Excluir
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Modal de Cliente
        function openClientModal(clientId) {
            currentClient = db.clients.find(c => c.id === clientId);
            if (!currentClient) return;
            
            document.getElementById('modalTitle').textContent = `Gerenciar - ${currentClient.name}`;
            
            const debt = db.getClientDebt(clientId);
            document.getElementById('clientInfo').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-medium text-gray-800">Nome:</h5>
                        <p class="text-gray-600">${currentClient.name}</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-800">Telefone:</h5>
                        <p class="text-gray-600">${currentClient.phone || 'Não informado'}</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-800">Endereço:</h5>
                        <p class="text-gray-600">${currentClient.address || 'Não informado'}</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-800">Valor em Aberto:</h5>
                        <p class="text-lg font-bold ${debt > 0 ? 'text-red-600' : 'text-green-600'}">R$ ${debt.toFixed(2)}</p>
                    </div>
                </div>
            `;
            
            loadPurchaseHistory(clientId);
            document.getElementById('clientModal').classList.remove('hidden');
            document.getElementById('clientModal').classList.add('flex');
        }

        // Carregar Histórico de Compras
        function loadPurchaseHistory(clientId) {
            const purchases = db.purchases.filter(p => p.clientId === clientId).sort((a, b) => new Date(b.date) - new Date(a.date));
            const payments = db.payments.filter(p => p.clientId === clientId).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const historyDiv = document.getElementById('purchaseHistory');
            
            const allTransactions = [
                ...purchases.map(p => ({...p, type: 'purchase'})),
                ...payments.map(p => ({...p, type: 'payment'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            historyDiv.innerHTML = allTransactions.map(transaction => `
                <div class="flex justify-between items-center p-3 border border-gray-200 rounded-lg">
                    <div>
                        <div class="font-medium ${transaction.type === 'purchase' ? 'text-red-600' : 'text-green-600'}">
                            ${transaction.type === 'purchase' ? transaction.product : 'Pagamento'}
                        </div>
                        <div class="text-sm text-gray-500">
                            ${new Date(transaction.date).toLocaleDateString('pt-BR')} às ${new Date(transaction.date).toLocaleTimeString('pt-BR')}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${transaction.type === 'purchase' ? 'text-red-600' : 'text-green-600'}">
                            ${transaction.type === 'purchase' ? '+' : '-'} R$ ${transaction.value.toFixed(2)}
                        </div>
                        <button onclick="deleteTransaction('${transaction.id}', '${transaction.type}')" class="text-xs text-red-500 hover:text-red-700">
                            Excluir
                        </button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-4">Nenhuma transação encontrada</p>';
        }

        // Adicionar Compra
        document.getElementById('purchaseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentClient) return;
            
            const purchase = {
                clientId: currentClient.id,
                product: document.getElementById('productName').value,
                value: parseFloat(document.getElementById('productValue').value)
            };
            
            db.addPurchase(purchase);
            
            // Limpar formulário
            this.reset();
            
            // Atualizar modal e dashboard
            loadPurchaseHistory(currentClient.id);
            updateDashboard();
            loadClientsList();
            
            // Atualizar info do cliente no modal
            const debt = db.getClientDebt(currentClient.id);
            document.querySelector('#clientInfo p:last-child').innerHTML = `R$ ${debt.toFixed(2)}`;
            document.querySelector('#clientInfo p:last-child').className = `text-lg font-bold ${debt > 0 ? 'text-red-600' : 'text-green-600'}`;
            
            showNotification('Compra adicionada com sucesso!', 'success');
        });

        // Registrar Pagamento
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentClient) return;
            
            const payment = {
                clientId: currentClient.id,
                value: parseFloat(document.getElementById('paymentAmount').value)
            };
            
            db.addPayment(payment);
            
            // Limpar formulário
            this.reset();
            
            // Atualizar modal e dashboard
            loadPurchaseHistory(currentClient.id);
            updateDashboard();
            loadClientsList();
            
            // Atualizar info do cliente no modal
            const debt = db.getClientDebt(currentClient.id);
            document.querySelector('#clientInfo p:last-child').innerHTML = `R$ ${debt.toFixed(2)}`;
            document.querySelector('#clientInfo p:last-child').className = `text-lg font-bold ${debt > 0 ? 'text-red-600' : 'text-green-600'}`;
            
            showNotification('Pagamento registrado com sucesso!', 'success');
        });

        // Fechar Modal
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('clientModal').classList.add('hidden');
            document.getElementById('clientModal').classList.remove('flex');
            currentClient = null;
        });

        // Excluir Cliente
        function deleteClient(clientId) {
            if (confirm('Tem certeza que deseja excluir este cliente? Todos os dados relacionados serão perdidos.')) {
                db.clients = db.clients.filter(c => c.id !== clientId);
                db.purchases = db.purchases.filter(p => p.clientId !== clientId);
                db.payments = db.payments.filter(p => p.clientId !== clientId);
                
                db.saveClients();
                db.savePurchases();
                db.savePayments();
                
                updateDashboard();
                loadClientsList();
                showNotification('Cliente excluído com sucesso!', 'success');
            }
        }

        // Excluir Transação
        function deleteTransaction(transactionId, type) {
            if (confirm('Tem certeza que deseja excluir esta transação?')) {
                if (type === 'purchase') {
                    db.purchases = db.purchases.filter(p => p.id !== transactionId);
                    db.savePurchases();
                } else {
                    db.payments = db.payments.filter(p => p.id !== transactionId);
                    db.savePayments();
                }
                
                loadPurchaseHistory(currentClient.id);
                updateDashboard();
                loadClientsList();
                
                // Atualizar info do cliente no modal
                const debt = db.getClientDebt(currentClient.id);
                document.querySelector('#clientInfo p:last-child').innerHTML = `R$ ${debt.toFixed(2)}`;
                document.querySelector('#clientInfo p:last-child').className = `text-lg font-bold ${debt > 0 ? 'text-red-600' : 'text-green-600'}`;
                
                showNotification('Transação excluída com sucesso!', 'success');
            }
        }

        // Notificações
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            } fade-in`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar alguns dados de exemplo se não houver dados
            if (db.clients.length === 0) {
                const exampleClients = [
                    { name: 'João Silva', phone: '(11) 99999-9999', address: 'Rua das Flores, 123' },
                    { name: 'Maria Santos', phone: '(11) 88888-8888', address: 'Av. Principal, 456' }
                ];
                
                exampleClients.forEach(client => db.addClient(client));
                
                // Adicionar algumas compras de exemplo
                db.addPurchase({ clientId: db.clients[0].id, product: 'Produto A', value: 25.50 });
                db.addPurchase({ clientId: db.clients[0].id, product: 'Produto B', value: 15.00 });
                db.addPurchase({ clientId: db.clients[1].id, product: 'Produto C', value: 30.00 });
                
                // Adicionar um pagamento de exemplo
                db.addPayment({ clientId: db.clients[0].id, value: 20.00 });
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98550407878e311f',t:'MTc1ODkxMzM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
